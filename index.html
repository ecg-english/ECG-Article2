<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Pronunciation Hub | è‹±èªç™ºéŸ³ãƒ»å®Œå…¨æ”»ç•¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-slate-50 min-h-screen pb-20">
    <div>
        <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆç™ºéŸ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰ -->
        <header class="hero-animate bg-indigo-900 text-white pt-12 pb-16 px-4 text-center rounded-b-[3rem] shadow-xl mb-10 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full pointer-events-none">
                <!-- ã‚¢ã‚¤ã‚³ãƒ³å¤‰æ›´: éŸ³ç¬¦ã‚„æ³¢å½¢ãªã© -->
                <i class="fa-solid fa-headphones-simple hero-bg-icon text-9xl absolute top-[-20px] left-[-20px] text-indigo-800"></i>
                <i class="fa-solid fa-microphone-lines hero-bg-icon text-9xl absolute bottom-[-20px] right-[-20px] text-indigo-800"></i>
            </div>
            <h1 class="hero-title text-3xl md:text-5xl font-bold mb-4 tracking-tight">Pronunciation Hub</h1>
            <p class="hero-subtitle text-slate-400 max-w-xl mx-auto">
                ãƒã‚¤ãƒ†ã‚£ãƒ–ã®éŸ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚<br>
                ã‚«ã‚¿ã‚«ãƒŠè‹±èªã‚’å’æ¥­ã—ã€é€šã˜ã‚‹ã€ŒéŸ³ã€ã‚’æ‰‹ã«å…¥ã‚Œã‚‹ã€‚
            </p>
        </header>

        <!-- ãƒ¬ãƒ™ãƒ«é¸æŠã‚°ãƒªãƒƒãƒ‰ -->
        <div class="px-4 max-w-4xl mx-auto -mt-10 grid gap-6 md:grid-cols-2 mb-12 relative z-10">
            <!-- Level 0: Phonics (Basic) -->
            <a href="level0/" class="level-card card-animate bg-white rounded-2xl shadow-lg overflow-hidden border border-slate-100" data-delay="0" data-level="0">
                <div class="h-2 bg-gradient-to-r from-cyan-400 to-cyan-600"></div>
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4 relative">
                        <div class="w-12 h-12 rounded-xl bg-cyan-600 text-white flex items-center justify-center text-2xl shadow-md">
                            <!-- ã‚¢ã‚¤ã‚³ãƒ³: éŸ³é‡/åŸºç¤ -->
                            <i class="fa-solid fa-volume-low"></i>
                        </div>
                        <div class="progress-chart" data-level="0">
                            <svg class="progress-ring" width="48" height="48">
                                <defs>
                                    <linearGradient id="gradient-0" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#22d3ee;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#0891b2;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <circle class="progress-ring-background" cx="24" cy="24" r="20" fill="none" stroke="#e2e8f0" stroke-width="4"></circle>
                                <circle class="progress-ring-circle" cx="24" cy="24" r="20" fill="none" stroke="url(#gradient-0)" stroke-width="4" stroke-linecap="round" transform="rotate(-90 24 24)"></circle>
                            </svg>
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <h2 class="text-xl font-bold text-slate-800 mb-1">è¶…å…¥é–€</h2>
                    <p class="text-xs font-bold text-cyan-600 uppercase tracking-wider mb-3">Level 0: Phonics</p>
                    <p class="text-sm text-slate-500 mb-6 min-h-[3em]">ãƒ•ã‚©ãƒ‹ãƒƒã‚¯ã‚¹ã¨ç™ºéŸ³è¨˜å·ã€‚æ¯éŸ³ã¨å­éŸ³ã®æ­£ã—ã„å£ã®å½¢ã‚’ä½œã‚‹ã€‚</p>
                    <div class="flex items-center text-sm font-bold text-cyan-600 group">
                        å­¦ç¿’ã‚’å§‹ã‚ã‚‹ <i class="fa-solid fa-arrow-right ml-2 transition-transform group-hover:translate-x-1"></i>
                    </div>
                </div>
            </a>

            <!-- Level 1: Linking (Beginner) -->
            <a href="level1/" class="level-card card-animate bg-white rounded-2xl shadow-lg overflow-hidden border border-slate-100" data-delay="100" data-level="1">
                <div class="h-2 bg-gradient-to-r from-emerald-400 to-emerald-600"></div>
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4 relative">
                        <div class="w-12 h-12 rounded-xl bg-emerald-600 text-white flex items-center justify-center text-2xl shadow-md">
                            <!-- ã‚¢ã‚¤ã‚³ãƒ³: ç¹‹ãŒã‚Š -->
                            <i class="fa-solid fa-link"></i>
                        </div>
                        <div class="progress-chart" data-level="1">
                            <svg class="progress-ring" width="48" height="48">
                                <defs>
                                    <linearGradient id="gradient-1" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#34d399;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#10b981;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <circle class="progress-ring-background" cx="24" cy="24" r="20" fill="none" stroke="#e2e8f0" stroke-width="4"></circle>
                                <circle class="progress-ring-circle" cx="24" cy="24" r="20" fill="none" stroke="url(#gradient-1)" stroke-width="4" stroke-linecap="round" transform="rotate(-90 24 24)"></circle>
                            </svg>
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <h2 class="text-xl font-bold text-slate-800 mb-1">åˆç´š</h2>
                    <p class="text-xs font-bold text-emerald-600 uppercase tracking-wider mb-3">Level 1: Linking</p>
                    <p class="text-sm text-slate-500 mb-6 min-h-[3em]">éŸ³ãŒã¤ãªãŒã‚‹ã€Œãƒªãƒ³ã‚­ãƒ³ã‚°ã€ã¨æ¶ˆãˆã‚‹éŸ³ã€‚Rã¨Lã€Thã®å®Œå…¨æ”»ç•¥ã€‚</p>
                    <div class="flex items-center text-sm font-bold text-emerald-600 group">
                        å­¦ç¿’ã‚’å§‹ã‚ã‚‹ <i class="fa-solid fa-arrow-right ml-2 transition-transform group-hover:translate-x-1"></i>
                    </div>
                </div>
            </a>

            <!-- Level 2: Rhythm (Intermediate) -->
            <a href="level2/" class="level-card card-animate bg-white rounded-2xl shadow-lg overflow-hidden border border-slate-100" data-delay="200" data-level="2">
                <div class="h-2 bg-gradient-to-r from-amber-400 to-amber-600"></div>
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4 relative">
                        <div class="w-12 h-12 rounded-xl bg-amber-500 text-white flex items-center justify-center text-2xl shadow-md">
                            <!-- ã‚¢ã‚¤ã‚³ãƒ³: æ³¢å½¢/ãƒªã‚ºãƒ  -->
                            <i class="fa-solid fa-wave-square"></i>
                        </div>
                        <div class="progress-chart" data-level="2">
                            <svg class="progress-ring" width="48" height="48">
                                <defs>
                                    <linearGradient id="gradient-2" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#fbbf24;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#d97706;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <circle class="progress-ring-background" cx="24" cy="24" r="20" fill="none" stroke="#e2e8f0" stroke-width="4"></circle>
                                <circle class="progress-ring-circle" cx="24" cy="24" r="20" fill="none" stroke="url(#gradient-2)" stroke-width="4" stroke-linecap="round" transform="rotate(-90 24 24)"></circle>
                            </svg>
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <h2 class="text-xl font-bold text-slate-800 mb-1">ä¸­ç´š</h2>
                    <p class="text-xs font-bold text-amber-600 uppercase tracking-wider mb-3">Level 2: Rhythm & Stress</p>
                    <p class="text-sm text-slate-500 mb-6 min-h-[3em]">è‹±èªç‰¹æœ‰ã®ãƒªã‚ºãƒ ã¨ã‚¹ãƒˆãƒ¬ã‚¹ï¼ˆå¼·å‹¢ï¼‰ã€‚ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå¼±åŒ–ï¼‰ã‚’å­¦ã¶ã€‚</p>
                    <div class="flex items-center text-sm font-bold text-amber-600 group">
                            å­¦ç¿’ã‚’å§‹ã‚ã‚‹ <i class="fa-solid fa-arrow-right ml-2 transition-transform group-hover:translate-x-1"></i>
                    </div>
                </div>
            </a>

            <!-- Level 3: Intonation (Advanced) -->
            <a href="level3/" class="level-card card-animate bg-white rounded-2xl shadow-lg overflow-hidden border border-slate-100" data-delay="300" data-level="3">
                <div class="h-2 bg-gradient-to-r from-purple-400 to-purple-600"></div>
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4 relative">
                        <div class="w-12 h-12 rounded-xl bg-purple-600 text-white flex items-center justify-center text-2xl shadow-md">
                            <!-- ã‚¢ã‚¤ã‚³ãƒ³: ãƒã‚¤ã‚¯/å®Ÿè·µ -->
                            <i class="fa-solid fa-microphone"></i>
                        </div>
                        <div class="progress-chart" data-level="3">
                            <svg class="progress-ring" width="48" height="48">
                                <defs>
                                    <linearGradient id="gradient-3" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#c084fc;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#9333ea;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <circle class="progress-ring-background" cx="24" cy="24" r="20" fill="none" stroke="#e2e8f0" stroke-width="4"></circle>
                                <circle class="progress-ring-circle" cx="24" cy="24" r="20" fill="none" stroke="url(#gradient-3)" stroke-width="4" stroke-linecap="round" transform="rotate(-90 24 24)"></circle>
                            </svg>
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <h2 class="text-xl font-bold text-slate-800 mb-1">ä¸Šç´š</h2>
                    <p class="text-xs font-bold text-purple-600 uppercase tracking-wider mb-3">Level 3: Flow & Shadowing</p>
                    <p class="text-sm text-slate-500 mb-6 min-h-[3em]">ã‚¤ãƒ³ãƒˆãƒãƒ¼ã‚·ãƒ§ãƒ³ã§æ„Ÿæƒ…ã‚’ä¹—ã›ã‚‹ã€‚ã‚·ãƒ£ãƒ‰ãƒ¼ã‚¤ãƒ³ã‚°ã«ã‚ˆã‚‹å®Ÿè·µãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€‚</p>
                    <div class="flex items-center text-sm font-bold text-purple-600 group">
                        å­¦ç¿’ã‚’å§‹ã‚ã‚‹ <i class="fa-solid fa-arrow-right ml-2 transition-transform group-hover:translate-x-1"></i>
                    </div>
                </div>
            </a>
        </div>
        
        <footer class="footer-animate text-center text-slate-400 text-sm pb-10">
            &copy; 2025 è‹±ä¼šè©±ã‚¸ãƒ  ECG
        </footer>
    </div>

    <!-- ECGãã‚“ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ -->
    <button id="ecgKunButton" class="ecg-kun-button fixed bottom-6 right-6 z-50 w-16 h-16 rounded-full bg-white shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center border-2 border-indigo-200 hover:border-indigo-400">
        <!-- ç”»åƒãƒ‘ã‚¹ã¯ãã®ã¾ã¾ç¶­æŒã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹å·¥å¤« -->
        <img id="ecgKunFloatingImg" src="image/ECGkun.png" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'" alt="ECGãã‚“" class="w-12 h-12 object-contain">
        <i class="fa-solid fa-robot text-3xl text-indigo-500" style="display:none"></i>
    </button>

    <!-- ECGãã‚“ãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="ecgChatModal" class="ecg-chat-modal fixed inset-0 z-[100] flex items-center justify-center pointer-events-none">
        <div class="ecg-chat-overlay absolute inset-0 bg-black/30 backdrop-blur-sm opacity-0 transition-opacity duration-300"></div>
        <div class="ecg-chat-container relative bg-white rounded-2xl shadow-2xl w-full max-w-2xl h-[80vh] max-h-[800px] flex flex-col transform scale-95 opacity-0 transition-all duration-300">
            <!-- ãƒãƒ£ãƒƒãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="ecg-chat-header bg-gradient-to-r from-indigo-500 to-indigo-600 text-white p-4 rounded-t-2xl flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img id="ecgKunHeaderImg" src="image/ECGkun.png" onerror="this.src='https://via.placeholder.com/40?text=ECG'" alt="ECGãã‚“" class="w-10 h-10 object-contain bg-white rounded-full">
                    <div>
                        <h3 class="font-bold text-lg">ECGç™ºéŸ³ã‚³ãƒ¼ãƒ</h3>
                        <p class="text-xs text-indigo-100">Listening...</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button id="ecgChatSettings" class="text-white/80 hover:text-white transition-colors" title="ECGãã‚“ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º">
                        <i class="fa-solid fa-palette text-lg"></i>
                    </button>
                    <button id="ecgChatClose" class="text-white/80 hover:text-white transition-colors">
                        <i class="fa-solid fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <!-- ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
            <div id="ecgChatMessages" class="ecg-chat-messages flex-1 overflow-y-auto p-4 space-y-4">
                <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯JavaScriptã§å‹•çš„ã«è¿½åŠ  -->
            </div>

            <!-- ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ï¼ˆé¸æŠè‚¢ãƒœã‚¿ãƒ³ç”¨ï¼‰ -->
            <div id="ecgChatOptions" class="ecg-chat-options p-4 border-t border-slate-200 space-y-2">
                <!-- é¸æŠè‚¢ãƒœã‚¿ãƒ³ã¯JavaScriptã§å‹•çš„ã«è¿½åŠ  -->
            </div>
        </div>
    </div>

    <!-- ECGãã‚“ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="ecgCustomizeModal" class="ecg-customize-modal fixed inset-0 z-[110] flex items-center justify-center pointer-events-none">
        <div class="ecg-customize-overlay absolute inset-0 bg-black/40 backdrop-blur-sm opacity-0 transition-opacity duration-300"></div>
        <div class="ecg-customize-container relative bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col transform scale-95 opacity-0 transition-all duration-300">
            <div class="ecg-customize-header bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-t-2xl flex items-center justify-between">
                <h3 class="font-bold text-lg">ã‚³ãƒ¼ãƒã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</h3>
                <button id="ecgCustomizeClose" class="text-white/80 hover:text-white transition-colors">
                    <i class="fa-solid fa-times text-xl"></i>
                </button>
            </div>
            <div class="ecg-customize-content p-6 overflow-y-auto">
                <p class="text-sm text-slate-600 mb-4">ç™ºéŸ³ãƒ¬ãƒƒã‚¹ãƒ³ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ã¨ã€æ–°ã—ã„ECGãã‚“ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒè§£æ”¾ã•ã‚Œã¾ã™ï¼</p>
                <div id="ecgCustomizeGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <!-- ç”»åƒé¸æŠã‚«ãƒ¼ãƒ‰ã¯JavaScriptã§å‹•çš„ã«è¿½åŠ  -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- è¨­å®š: æ–‡æ³•ç·¨ã¨åŒºåˆ¥ã™ã‚‹ãŸã‚ã€IDã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ 'p' (Pronunciation) ã«å¤‰æ›´ ---
        
        // å„ãƒ¬ãƒ™ãƒ«ã®ãƒ¬ãƒƒã‚¹ãƒ³æ•°ã¨ãƒ¬ãƒƒã‚¹ãƒ³IDã®å®šç¾©ï¼ˆç™ºéŸ³ç”¨ï¼‰
        const levelConfig = {
            0: { total: 6, lessons: ['l0-1', 'l0-2', 'l0-3', 'l0-4', 'l0-5', 'l0-6'] },
            1: { total: 6, lessons: ['l1-7', 'l1-8', 'l1-9', 'l1-10', 'l1-11', 'l1-12'] },
            2: { total: 6, lessons: ['l2-13', 'l2-14', 'l2-15', 'l2-16', 'l2-17', 'l2-18'] },
            3: { total: 8, lessons: ['l3-19', 'l3-20', 'l3-21', 'l3-22', 'l3-23', 'l3-24', 'l3-25', 'l3-26'] }
        };

        // é”æˆç‡ã‚’è¨ˆç®—ã—ã¦å††ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
        function updateProgressChart(level, delay = 0) {
            const config = levelConfig[level];
            if (!config) return;

            let completedCount = 0;
            config.lessons.forEach(lessonId => {
                const key = `lesson_completed_${lessonId}`;
                if (localStorage.getItem(key) === 'true') {
                    completedCount++;
                }
            });

            const percentage = Math.round((completedCount / config.total) * 100);
            const chart = document.querySelector(`.progress-chart[data-level="${level}"]`);
            if (!chart) return;

            const circle = chart.querySelector('.progress-ring-circle');
            const text = chart.querySelector('.progress-text');
            
            if (circle && text) {
                const circumference = 2 * Math.PI * 20; // r=20
                const offset = circumference - (percentage / 100) * circumference;
                
                // åˆæœŸçŠ¶æ…‹ã‚’è¨­å®š
                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                circle.style.strokeDashoffset = circumference; // 0%ã‹ã‚‰é–‹å§‹
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ã‚’é…å»¶
                setTimeout(() => {
                    circle.style.strokeDashoffset = offset;
                    
                    // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã®ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                    animateCounter(text, 0, percentage, 800);
                }, delay);
            }
        }

        // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        function animateCounter(element, start, end, duration) {
            const startTime = performance.now();
            const animate = (currentTime) => {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeOut = 1 - Math.pow(1 - progress, 3);
                const current = Math.round(start + (end - start) * easeOut);
                element.textContent = `${current}%`;
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    element.textContent = `${end}%`;
                }
            };
            requestAnimationFrame(animate);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç™ºå‹•
        document.addEventListener('DOMContentLoaded', function() {
            // ã‚«ãƒ¼ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            const cards = document.querySelectorAll('.card-animate');
            cards.forEach((card, index) => {
                const delay = parseInt(card.getAttribute('data-delay')) || 0;
                const level = parseInt(card.getAttribute('data-level')) || 0;
                const cardDelay = 300 + delay * 0.5;
                
                setTimeout(() => {
                    card.classList.add('visible');
                    const icon = card.querySelector('.w-12');
                    const title = card.querySelector('h2');
                    const desc = card.querySelector('p.text-xs');
                    const text = card.querySelector('p.text-sm');
                    const button = card.querySelector('.flex.items-center');
                    
                    if (icon) setTimeout(() => { icon.style.animationDelay = '0.1s'; }, 100);
                    
                    [title, desc, text, button].forEach((el, i) => {
                        if (el) {
                            el.style.opacity = '0';
                            el.style.transform = 'translateY(10px)';
                            setTimeout(() => {
                                el.style.transition = 'all 0.3s ease-out';
                                el.style.opacity = '1';
                                el.style.transform = 'translateY(0)';
                            }, 50 + (i * 50));
                        }
                    });
                    
                    updateProgressChart(level, cardDelay + 600);
                }, cardDelay);
            });

            const footer = document.querySelector('.footer-animate');
            setTimeout(() => { footer.classList.add('visible'); }, 600);

            initECGChat();
        });

        // ECGãã‚“ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ï¼ˆç™ºéŸ³ç·¨ç”¨ãƒ‡ãƒ¼ã‚¿ï¼‰
        function initECGChat() {
            const chatButton = document.getElementById('ecgKunButton');
            const chatModal = document.getElementById('ecgChatModal');
            const chatClose = document.getElementById('ecgChatClose');
            const chatMessages = document.getElementById('ecgChatMessages');
            const chatOptions = document.getElementById('ecgChatOptions');

            // Q&Aãƒ‡ãƒ¼ã‚¿ (ç™ºéŸ³å­¦ç¿’ç”¨ã«å†…å®¹ã‚’å¤‰æ›´)
            const qaData = [
                {
                    question: 'ä»Šã®å­¦ç¿’é€²æ—ã‚’æ•™ãˆã¦',
                    type: 'progress',
                    answer: null
                },
                {
                    question: 'ãŠã™ã™ã‚ã®ãƒ¬ãƒƒã‚¹ãƒ³ã¯ï¼Ÿ',
                    type: 'recommendation',
                    answer: null
                },
                {
                    question: 'èˆŒãŒç–²ã‚Œã¦å‹•ã‹ãªã„...',
                    answer: 'ãã‚Œã¯è‰¯ã„å…†å€™ã§ã™ï¼æ—¥æœ¬èªã«ã¯ãªã„èˆŒã®ç­‹è‚‰ã‚’ä½¿ã£ã¦ã„ã‚‹è¨¼æ‹ ã§ã™ã€‚ç­‹ãƒˆãƒ¬ã¨åŒã˜ã§ã€æœ€åˆã¯ç–²ã‚Œã¾ã™ãŒã€ç¶šã‘ã‚‹ã“ã¨ã§æ»‘ã‚‰ã‹ã«å‹•ãã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ç„¡ç†ã›ãšä¼‘æ†©ã—ãªãŒã‚‰ã‚„ã‚Šã¾ã—ã‚‡ã†ï¼'
                },
                {
                    question: 'Rã¨LãŒèãå–ã‚Œãªã„',
                    answer: 'ã¾ãšã¯ã€Œè‡ªåˆ†ã§ç™ºéŸ³ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€ã“ã¨ãŒè¿‘é“ã§ã™ã€‚Level 1ã®ã€ŒRã¨Lã€ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§èˆŒã®ä½ç½®ã‚’ç¢ºèªã—ã€å¤§ã’ã•ã«ç™ºéŸ³ã™ã‚‹ç·´ç¿’ã‚’ã—ã¦ã¿ã¦ãã ã•ã„ã€‚è‡ªåˆ†ãŒè¨€ãˆã‚‹éŸ³ã¯ã€èãå–ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼'
                },
                {
                    question: 'è‡ªåˆ†ã®ç™ºéŸ³ã‚’ç¢ºèªã™ã‚‹ã«ã¯ï¼Ÿ',
                    answer: 'ã‚¹ãƒãƒ›ã®éŒ²éŸ³æ©Ÿèƒ½ã‚’ä½¿ã†ã®ãŒä¸€ç•ªã§ã™ï¼ãŠæ‰‹æœ¬ã®éŸ³å£°ã‚’èã„ãŸå¾Œã€è‡ªåˆ†ã®å£°ã‚’éŒ²éŸ³ã—ã¦èãæ¯”ã¹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã€Œå®¢è¦³çš„ã«è‡ªåˆ†ã®å£°ã‚’èãã€ã“ã¨ãŒä¸Šé”ã¸ã®ç¬¬ä¸€æ­©ã§ã™ã€‚'
                },
                {
                    question: 'ãƒã‚¤ãƒ†ã‚£ãƒ–ã£ã½ãè©±ã—ãŸã„ï¼',
                    answer: 'Level 2ã®ã€Œãƒªã‚ºãƒ ã€ã¨ã€Œãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆéŸ³ã®è„±è½ï¼‰ã€ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚å˜èªã‚’ä¸€ã¤ä¸€ã¤ã¯ã£ãã‚Šè¨€ã†ã®ã§ã¯ãªãã€é‡è¦ãªå˜èªã‚’å¼·ãã€ãã‚Œä»¥å¤–ã‚’å¼±ããƒ»é€Ÿãè¨€ã†ã®ãŒã‚³ãƒ„ã§ã™ã€‚'
                }
            ];

            let isInitialized = false;

            function openChat() {
                chatModal.classList.add('active');
                if (!isInitialized) {
                    showInitialMessage();
                    isInitialized = true;
                }
            }

            function closeChat() {
                chatModal.classList.remove('active');
            }

            function showInitialMessage() {
                chatMessages.innerHTML = '';
                chatOptions.innerHTML = '';

                const selectedImageId = localStorage.getItem('ecg_selected_image') || 'default';
                // ç”»åƒãƒ‘ã‚¹ã¯å…±é€šã®å ´æ‰€ã‚’å‚ç…§
                const ecgImages = [
                    { id: 'default', path: 'image/ECGkun.png' },
                    { id: 'lv1', path: 'image/ECGkun-lv1.png' },
                    { id: 'lv2', path: 'image/ECGkun-lv2.png' },
                    { id: 'lv3', path: 'image/ECGkun-lv3.png' },
                    // ...ä»–ã‚‚åŒæ§˜
                ];
                const selectedImage = ecgImages.find(img => img.id === selectedImageId) || ecgImages[0];
                
                // ç™ºéŸ³ãƒãƒ–ç”¨ã®åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                const initialMessage = `
                    <div class="ecg-message ecg-message-ecg">
                        <div class="ecg-message-avatar">
                            <img src="${selectedImage.path}" onerror="this.src='https://via.placeholder.com/40?text=ECG'" alt="ECGãã‚“">
                        </div>
                        <div class="ecg-message-content">
                            <p>Hi there! ç™ºéŸ³ã‚³ãƒ¼ãƒã®ECGãã‚“ã§ã™ï¼ğŸ™ï¸</p>
                            <p class="mt-2">Pronunciation Hubã¸ã‚ˆã†ã“ãï¼</p>
                            <p class="mt-2">ã“ã“ã§ã¯ã€è‹±èªã®ã€ŒéŸ³ã€ã®ãƒ«ãƒ¼ãƒ«ã‚’ä½“æ„Ÿã—ãªãŒã‚‰å­¦ã³ã¾ã™ã€‚</p>
                            <p class="mt-2"><strong>ä½¿ã„æ–¹ï¼š</strong></p>
                            <ul class="mt-2 space-y-1 text-sm list-disc list-inside">
                                <li><strong>Level 0:</strong> ã¾ãšã¯ãƒ•ã‚©ãƒ‹ãƒƒã‚¯ã‚¹ã§åŸºç¤å›ºã‚</li>
                                <li><strong>Level 1:</strong> éŸ³ã®ç¹‹ãŒã‚Šï¼ˆãƒªãƒ³ã‚­ãƒ³ã‚°ï¼‰ã‚’å­¦ã¶</li>
                                <li><strong>Level 2:</strong> è‹±èªç‰¹æœ‰ã®ãƒªã‚ºãƒ ã‚’ç¿’å¾—</li>
                                <li><strong>Level 3:</strong> æ„Ÿæƒ…ã‚’ä¹—ã›ã‚‹ã‚¤ãƒ³ãƒˆãƒãƒ¼ã‚·ãƒ§ãƒ³</li>
                            </ul>
                            <p class="mt-3">å®Ÿéš›ã«å£ã‚’å‹•ã‹ã™ã“ã¨ãŒå¤§åˆ‡ã§ã™ï¼ä½•ã‹è³ªå•ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ</p>
                        </div>
                    </div>
                `;
                chatMessages.innerHTML = initialMessage;
                scrollToBottom();
                setTimeout(() => { showQAOptions(); }, 500);
            }

            function showQAOptions() {
                chatOptions.innerHTML = '';
                qaData.forEach((qa) => {
                    const button = document.createElement('button');
                    button.className = 'ecg-option-button';
                    button.textContent = qa.question;
                    button.addEventListener('click', () => {
                        showAnswer(qa.question, qa.answer, qa.type);
                        chatOptions.innerHTML = '';
                    });
                    chatOptions.appendChild(button);
                });
            }

            function getProgress() {
                // ç™ºéŸ³ç”¨ã® config ã‚’ä½¿ç”¨
                const pLevelConfig = {
                    0: { total: 6, lessons: ['l0-1', 'l0-2', 'l0-3', 'l0-4', 'l0-5', 'l0-6'], name: 'Level 0 (Phonics)' },
                    1: { total: 6, lessons: ['l1-7', 'l1-8', 'l1-9', 'l1-10', 'l1-11', 'l1-12'], name: 'Level 1 (Linking)' },
                    2: { total: 6, lessons: ['l2-13', 'l2-14', 'l2-15', 'l2-16', 'l2-17', 'l2-18'], name: 'Level 2 (Rhythm)' },
                    3: { total: 8, lessons: ['l3-19', 'l3-20', 'l3-21', 'l3-22', 'l3-23', 'l3-24', 'l3-25', 'l3-26'], name: 'Level 3 (Intonation)' }
                };

                let totalLessons = 0;
                let completedLessons = 0;
                const levelProgress = [];

                Object.keys(pLevelConfig).forEach(level => {
                    const config = pLevelConfig[level];
                    let levelCompleted = 0;
                    config.lessons.forEach(lessonId => {
                        totalLessons++;
                        const key = `lesson_completed_${lessonId}`;
                        if (localStorage.getItem(key) === 'true') {
                            completedLessons++;
                            levelCompleted++;
                        }
                    });
                    const percentage = Math.round((levelCompleted / config.total) * 100);
                    levelProgress.push({
                        name: config.name,
                        completed: levelCompleted,
                        total: config.total,
                        percentage: percentage
                    });
                });

                return {
                    total: completedLessons,
                    totalLessons: totalLessons,
                    percentage: Math.round((completedLessons / totalLessons) * 100),
                    levels: levelProgress
                };
            }

            function getRecommendation() {
                 const pLevelConfig = {
                    0: { lessons: ['l0-1', 'l0-2', 'l0-3', 'l0-4', 'l0-5', 'l0-6'], name: 'Level 0', url: 'level0/' },
                    1: { lessons: ['l1-7', 'l1-8', 'l1-9', 'l1-10', 'l1-11', 'l1-12'], name: 'Level 1', url: 'level1/' },
                    2: { lessons: ['l2-13', 'l2-14', 'l2-15', 'l2-16', 'l2-17', 'l2-18'], name: 'Level 2', url: 'level2/' },
                    3: { lessons: ['l3-19', 'l3-20', 'l3-21', 'l3-22', 'l3-23', 'l3-24', 'l3-25', 'l3-26'], name: 'Level 3', url: 'level3/' }
                };

                for (let level = 0; level <= 3; level++) {
                    const config = pLevelConfig[level];
                    for (let i = 0; i < config.lessons.length; i++) {
                        const lessonId = config.lessons[i];
                        const key = `lesson_completed_${lessonId}`;
                        if (localStorage.getItem(key) !== 'true') {
                            // ãƒ¬ãƒƒã‚¹ãƒ³IDã‹ã‚‰ç•ªå·ã‚’å–å¾—ï¼ˆä¾‹: l0-1 -> 1, l1-7 -> 7ï¼‰
                            const lessonNum = parseInt(lessonId.split('-')[1]);
                            return {
                                level: config.name,
                                lessonNum: lessonNum,
                                url: `${config.url}lesson-${lessonId}.html`
                            };
                        }
                    }
                }
                return null;
            }

            function showAnswer(question, answer, type) {
                const userMessage = document.createElement('div');
                userMessage.className = 'ecg-message ecg-message-user';
                userMessage.innerHTML = `
                    <div class="ecg-message-avatar">
                        <i class="fa-solid fa-user text-indigo-500 text-xl flex items-center justify-center h-full"></i>
                    </div>
                    <div class="ecg-message-content">
                        <p>${question}</p>
                    </div>
                `;
                chatMessages.appendChild(userMessage);
                scrollToBottom();

                setTimeout(() => {
                    const ecgMessage = document.createElement('div');
                    ecgMessage.className = 'ecg-message ecg-message-ecg';
                    let answerText = '';
                    
                    if (type === 'progress') {
                        const progress = getProgress();
                        answerText = `
                            <p><strong>ç¾åœ¨ã®å­¦ç¿’é€²æ—ï¼ˆç™ºéŸ³ç·¨ï¼‰ï¼š</strong></p>
                            <p class="mt-2">å…¨ä½“: <strong>${progress.total}/${progress.totalLessons}ãƒ¬ãƒƒã‚¹ãƒ³</strong> ã‚¯ãƒªã‚¢ï¼ˆ${progress.percentage}%ï¼‰</p>
                            <div class="mt-3 space-y-2">
                                ${progress.levels.map(level => `
                                    <p class="text-sm">${level.name}: ${level.completed}/${level.total}ï¼ˆ${level.percentage}%ï¼‰</p>
                                `).join('')}
                            </div>
                            <p class="mt-3">æ¯æ—¥å°‘ã—ãšã¤å£ã‚’å‹•ã‹ã—ã¾ã—ã‚‡ã†ï¼ğŸ‘„</p>
                        `;
                    } else if (type === 'recommendation') {
                        const recommendation = getRecommendation();
                        if (recommendation) {
                            answerText = `
                                <p>æ¬¡ã¯ <strong>${recommendation.level}</strong> ã® <strong>ãƒ¬ãƒƒã‚¹ãƒ³${recommendation.lessonNum}</strong> ãŒãŠã™ã™ã‚ã§ã™ï¼</p>
                                <p class="mt-2">å‰ã®ãƒ¬ãƒƒã‚¹ãƒ³ã®éŸ³ã‚’æ„è­˜ã—ãªãŒã‚‰é€²ã‚ã¾ã—ã‚‡ã†ã€‚Keep going! âœ¨</p>
                            `;
                        } else {
                            answerText = `
                                <p>ğŸ‰ Amazing! å…¨ã¦ã®ç™ºéŸ³ãƒ¬ãƒƒã‚¹ãƒ³ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸï¼</p>
                                <p class="mt-2">ã“ã‚Œã‹ã‚‰ã¯ã€æ˜ ç”»ã‚„ãƒ‰ãƒ©ãƒã§ã‚·ãƒ£ãƒ‰ãƒ¼ã‚¤ãƒ³ã‚°ã‚’ã—ã¦ã€ã•ã‚‰ã«ç£¨ãã‚’ã‹ã‘ã¾ã—ã‚‡ã†ï¼</p>
                            `;
                        }
                    } else {
                        answerText = `<p>${answer}</p>`;
                    }
                    
                    const selectedImageId = localStorage.getItem('ecg_selected_image') || 'default';
                    // ç°¡æ˜“çš„ãªå‚ç…§
                    const ecgImages = [
                        { id: 'default', path: 'image/ECGkun.png' },
                         // ... ä»–ã®ãƒ‘ã‚¹
                    ];
                    const selectedImage = ecgImages.find(img => img.id === selectedImageId) || {path: 'image/ECGkun.png'};

                    ecgMessage.innerHTML = `
                        <div class="ecg-message-avatar">
                            <img src="${selectedImage.path}" onerror="this.src='https://via.placeholder.com/40?text=ECG'" alt="ECGãã‚“">
                        </div>
                        <div class="ecg-message-content">${answerText}</div>
                    `;
                    chatMessages.appendChild(ecgMessage);
                    scrollToBottom();
                    setTimeout(() => { showQAOptions(); }, 500);
                }, 300);
            }

            function scrollToBottom() {
                setTimeout(() => { chatMessages.scrollTop = chatMessages.scrollHeight; }, 100);
            }

            chatButton.addEventListener('click', openChat);
            chatClose.addEventListener('click', closeChat);
            chatModal.querySelector('.ecg-chat-overlay').addEventListener('click', closeChat);
            initECGCustomize();
        }

        // ECGãã‚“ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½ï¼ˆãƒ­ã‚¸ãƒƒã‚¯ã¯æ–‡æ³•ç·¨ã¨å…±é€šã ãŒã€å‚ç…§ã™ã‚‹é€²æ—ã¯ç™ºéŸ³ç·¨ã®ã‚‚ã®ã‚’ä½¿ç”¨ï¼‰
        function initECGCustomize() {
            const customizeButton = document.getElementById('ecgChatSettings');
            const customizeModal = document.getElementById('ecgCustomizeModal');
            const customizeClose = document.getElementById('ecgCustomizeClose');
            const customizeGrid = document.getElementById('ecgCustomizeGrid');
            const floatingImg = document.getElementById('ecgKunFloatingImg');
            const headerImg = document.getElementById('ecgKunHeaderImg');

            const ecgImages = [
                { id: 'default', name: 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ', path: 'image/ECGkun.png', unlockAt: 0 },
                { id: 'lv1', name: 'ãƒ¬ãƒ™ãƒ«1', path: 'image/ECGkun-lv1.png', unlockAt: 2 },
                { id: 'lv2', name: 'ãƒ¬ãƒ™ãƒ«2', path: 'image/ECGkun-lv2.png', unlockAt: 4 },
                { id: 'lv3', name: 'ãƒ¬ãƒ™ãƒ«3', path: 'image/ECGkun-lv3.png', unlockAt: 6 },
                { id: 'lv4', name: 'ãƒ¬ãƒ™ãƒ«4', path: 'image/ECGkun-lv4.png', unlockAt: 9 },
                { id: 'lv5', name: 'ãƒ¬ãƒ™ãƒ«5', path: 'image/ECGkun-lv5.png', unlockAt: 12 },
                { id: 'lv6', name: 'ãƒ¬ãƒ™ãƒ«6', path: 'image/ECGkun-lv6.png', unlockAt: 14 },
                { id: 'lv7', name: 'ãƒ¬ãƒ™ãƒ«7', path: 'image/ECGkun-lv7.png', unlockAt: 18 },
                { id: 'lv8', name: 'ãƒ¬ãƒ™ãƒ«8', path: 'image/ECGkun-lv8.png', unlockAt: 21 },
                { id: 'lv9', name: 'ãƒ¬ãƒ™ãƒ«9', path: 'image/ECGkun-lv9.png', unlockAt: 23 },
                { id: 'lv10', name: 'ãƒ¬ãƒ™ãƒ«10', path: 'image/ECGkun-lv10.png', unlockAt: 26 }
            ];

            // ãƒ¬ãƒƒã‚¹ãƒ³IDã®é †åºå®šç¾©ï¼ˆãƒ¬ãƒƒã‚¹ãƒ³ç•ªå·é †ï¼‰
            const lessonOrder = [
                'l0-1','l0-2','l0-3','l0-4','l0-5','l0-6',
                'l1-7','l1-8','l1-9','l1-10','l1-11','l1-12',
                'l2-13','l2-14','l2-15','l2-16','l2-17','l2-18',
                'l3-19','l3-20','l3-21','l3-22','l3-23','l3-24','l3-25','l3-26'
            ];

            // ãƒ¬ãƒƒã‚¹ãƒ³1ã‹ã‚‰æŒ‡å®šã•ã‚ŒãŸãƒ¬ãƒƒã‚¹ãƒ³ç•ªå·ã¾ã§é€£ç¶šã—ã¦ã‚¯ãƒªã‚¢ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            function isConsecutiveLessonsCompleted(upToLessonNum) {
                if (upToLessonNum === 0) return true; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å¸¸ã«è§£æ”¾
                
                // ãƒ¬ãƒƒã‚¹ãƒ³1ã‹ã‚‰upToLessonNumã¾ã§é€£ç¶šã—ã¦ã‚¯ãƒªã‚¢ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                for (let i = 0; i < upToLessonNum; i++) {
                    const lessonId = lessonOrder[i];
                    if (!lessonId) return false; // ãƒ¬ãƒƒã‚¹ãƒ³IDãŒå­˜åœ¨ã—ãªã„å ´åˆã¯false
                    
                    const key = `lesson_completed_${lessonId}`;
                    if (localStorage.getItem(key) !== 'true') {
                        return false; // 1ã¤ã§ã‚‚æœªã‚¯ãƒªã‚¢ãŒã‚ã‚Œã°false
                    }
                }
                return true; // ã™ã¹ã¦é€£ç¶šã—ã¦ã‚¯ãƒªã‚¢ã—ã¦ã„ã‚‹
            }

            function getSelectedImage() { return localStorage.getItem('ecg_selected_image') || 'default'; }

            function applyImage(imageId) {
                const image = ecgImages.find(img => img.id === imageId) || ecgImages[0];
                const fallback = "this.src='https://via.placeholder.com/40?text=ECG'";
                
                // Set images with simple error handling logic embedded in HTML attributes previously
                if(floatingImg) floatingImg.src = image.path;
                if(headerImg) headerImg.src = image.path;
                
                const chatAvatars = document.querySelectorAll('.ecg-message-ecg .ecg-message-avatar img');
                chatAvatars.forEach(avatar => { avatar.src = image.path; });
            }

            function openCustomizeModal() {
                customizeModal.classList.add('active');
                renderCustomizeGrid();
            }
            function closeCustomizeModal() { customizeModal.classList.remove('active'); }

            function renderCustomizeGrid() {
                customizeGrid.innerHTML = '';
                const selectedId = getSelectedImage();

                ecgImages.forEach(image => {
                    const isUnlocked = isConsecutiveLessonsCompleted(image.unlockAt);
                    const isSelected = image.id === selectedId;
                    const card = document.createElement('div');
                    
                    // Style adaptations for Indigo theme
                    card.className = `ecg-image-card relative bg-white rounded-xl border-2 overflow-hidden transition-all ${
                        isUnlocked 
                            ? isSelected 
                                ? 'border-indigo-500 shadow-lg cursor-pointer' 
                                : 'border-slate-200 hover:border-indigo-300 hover:shadow-md cursor-pointer'
                            : 'border-slate-300 cursor-not-allowed'
                    }`;

                    card.innerHTML = `
                        <div class="aspect-square p-4 flex items-center justify-center bg-slate-50 relative">
                            <img src="${image.path}" onerror="this.src='https://via.placeholder.com/80?text=Locked'" alt="${image.name}" class="w-full h-full object-contain ${
                                isUnlocked ? '' : 'ecg-image-silhouette'
                            }">
                            ${!isUnlocked ? `<div class="absolute top-2 right-2 bg-slate-700/80 rounded-full p-1.5"><i class="fa-solid fa-lock text-white text-xs"></i></div>` : ''}
                        </div>
                        <div class="p-3 border-t border-slate-100">
                            <p class="text-sm font-bold ${isUnlocked ? 'text-slate-800' : 'text-slate-500'}">${image.name}</p>
                            ${isUnlocked 
                                ? isSelected 
                                    ? '<p class="text-xs text-indigo-600 mt-1"><i class="fa-solid fa-check-circle mr-1"></i>é¸æŠä¸­</p>'
                                    : '<p class="text-xs text-green-600 mt-1"><i class="fa-solid fa-unlock mr-1"></i>è§£æ”¾æ¸ˆã¿</p>'
                                : image.unlockAt === 0 
                                    ? '<p class="text-xs text-slate-500 mt-1 font-medium">åˆæœŸã‚¹ã‚¿ã‚¤ãƒ«</p>'
                                    : `<p class="text-xs text-slate-500 mt-1 font-medium">ãƒ¬ãƒƒã‚¹ãƒ³1ï½${image.unlockAt}ã‚’ã‚¯ãƒªã‚¢ã§è§£æ”¾</p>`
                            }
                        </div>
                    `;

                    if (isUnlocked) {
                        card.addEventListener('click', () => {
                            localStorage.setItem('ecg_selected_image', image.id);
                            applyImage(image.id);
                            renderCustomizeGrid();
                        });
                    }
                    customizeGrid.appendChild(card);
                });
            }

            applyImage(getSelectedImage());
            customizeButton.addEventListener('click', openCustomizeModal);
            customizeClose.addEventListener('click', closeCustomizeModal);
            customizeModal.querySelector('.ecg-customize-overlay').addEventListener('click', closeCustomizeModal);
        }
    </script>
</body>
</html>